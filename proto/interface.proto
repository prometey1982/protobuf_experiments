syntax = "proto3";

option java_multiple_files = true;
option java_package = "protobuf_experiments";
option java_outer_classname = "PBExperiments";
option objc_class_prefix = "PBE";

package protobuf_experiments;

message RequestHeader {
    uint32 version = 1;
    RequestType request_type = 2;
    string vin = 3;
}

message ResponseHeader {
    uint32 version = 1;
    ResponseType response_type = 2;
}

enum RequestType {
    REQ_AVAILABLE_PROJECTS = 0;
    REQ_PROJECT = 1;
    REQ_LOGS_UPLOAD = 2;
    REQ_FLASH_UPLOAD = 3;
}

enum ResponseType {
    RESP_AVAILABLE_PROJECTS = 0;
    RESP_PROJECT = 2;
    RESP_LOGS_UPLOAD = 3;
    RESP_FLASH_UPLOAD = 4;
}

message Request {
    RequestHeader header = 1;
    oneof payload {
        AvailableProjectsRequest available_projects = 2;
        ProjectRequest project = 3;
        LogsUploadRequest logs_upload = 4;
        FlashUploadRequest flash_upload = 5;
    }
}

message AvailableProjectsRequest {
}

message ProjectRequest {
    string name = 1;
}

message LogsUploadRequest {
    string name = 1;
    bytes payload = 2;
}

message FlashUploadRequest {
    string name = 1;
    bytes payload = 2;
}

message Response {
    ResponseHeader header = 1;
    oneof payload {
        AvailableProjectsResponse available_projects = 2;
        ProjectResponse project = 3;
    }
}

message AvailableProject {
    string name = 1;
    uint32 crc = 2;
}

message AvailableProjectsResponse {
    repeated AvailableProject available_projects = 1;
}

message ProjectResponse {
    bytes data = 1;
}

message LogsUploadResponse {
}

message FlashUploadResponse {
}
